# Openfold Embeddings

- Gets embeddings from openfold model
- requires gpus (doesn't work on NVIDIA TITAN RTX but does on A100)

## Steps

1. clone and install openfold according to their [instructions](https://openfold.readthedocs.io/en/latest/Installation.html)

2. download mmcif files (using openfold instructions)

```Bash
bash scripts/download_mmseqs_dbs.sh data/    # downloads .tar files
bash scripts/prep_mmseqs_dbs.sh data/        # unpacks and preps the databases
```

3. clone and install collabfold according to their [instructions](https://github.com/sokrypton/ColabFold)

4. at the top of the `openfold_func.py` and `run_openfold.py` file add your openfold and collabfold dir paths

5. run `run_openfold.py -i "input_dir" -m "mmcif_dir" -a True`
```markdown
### Command Line Arguments

- `-i`, `--input_dir`: Specifies the directory containing the input files to be processed.
- `-m`, `--mmcif_dir`: Specifies the directory containing the mmCIF files required for processing.
- `-a`, `--align`: A boolean flag (`True`/`False`) indicating whether to perform alignment during processing. (collabfold api`)
```

- input_dir should contain a folder called `fasta` that contains the fasta files to create embeddings out of
- the script should create an alignment_dir (if align is True) and an embedding dir (either step_7 or step_9, user can choose what layer they want to get embeddings from)


## Scripts

- `openfold_func.py` contains functions for getting embeddings from Openfold (/ AlphaFold) structure module. 
    - requires cudatoolkit 11.6 and cudnn 8.3.2.44

- `run_openfold.py` runs `openfold_func.py`

- `clean_aln.sh` cleans the alignments generated by colabfold (code in `openfold_embeddings.py`) 
    - there's a null character at the end of all the .a3m files

## Citations

ColabFold:
Mirdita, M., Schütze, K., Moriwaki, Y. et al.
ColabFold: making protein folding accessible to all.
Nat Methods 19, 679–682 (2022).
https://doi.org/10.1038/s41592-022-01488-1

OpenFold:
Ahdritz, G., Strokach, A., Wolf, T. et al.
OpenFold: transparent and reproducible protein structure prediction.
Nat Methods (2024).
https://doi.org/10.1038/s41592-024-02272-z